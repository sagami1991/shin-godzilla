{"version":3,"sources":["websocket/SkillController.ts"],"names":[],"mappings":";AAEA,sBAA8C,gBAAgB,CAAC,CAAA;AAG/D;IACC,yBAAoB,SAAoB,EAAU,cAAkC;QAAhE,cAAS,GAAT,SAAS,CAAW;QAAU,mBAAc,GAAd,cAAc,CAAoB;IACpF,CAAC;IAEM,8BAAI,GAAX;QAAA,iBAEC;QADA,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,kBAAU,CAAC,QAAQ,EAAE,UAAC,EAAE,EAAE,GAAG,IAAK,OAAA,KAAI,CAAC,UAAU,CAAC,EAAE,EAAE,GAAG,CAAC,EAAxB,CAAwB,CAAC,CAAC;IAC1F,CAAC;IAEO,oCAAU,GAAlB,UAAmB,EAAa,EAAE,GAAY;QAC7C,IAAM,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;QAC7C,EAAE,CAAC,CAAC,IAAI,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;YACtC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACtB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,EAAE,kBAAU,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;QACpD,CAAC;IACF,CAAC;IAEO,kCAAQ,GAAhB,UAAiB,GAAW,EAAE,IAAgB;QAC7C,MAAM,CAAC,CACN,OAAO,GAAG,KAAK,QAAQ;YACvB,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;YAC3B,IAAI,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,EAAE,CAAC;IAC3C,CAAC;IACF,sBAAC;AAAD,CAtBA,AAsBC,IAAA;AAtBY,uBAAe,kBAsB3B,CAAA","file":"websocket/SkillController.js","sourcesContent":["import * as WebSocket from 'ws';\r\nimport {WSWrapper} from \"./WebSocketWrapper\";\r\nimport {SocketType, SkillId, DbUserData} from \"../share/share\";\r\nimport {UserDataController} from \"./UserDataController\";\r\n\r\nexport class SkillController {\r\n\tconstructor(private wsWrapper: WSWrapper, private userController: UserDataController) {\r\n\t}\r\n\r\n\tpublic init() {\r\n\t\tthis.wsWrapper.addMsgListner(SocketType.getSkill, (ws, req) => this.onGetSkill(ws, req));\r\n\t}\r\n\r\n\tprivate onGetSkill(ws: WebSocket, req: SkillId) {\r\n\t\tconst user = this.userController.getUser(ws);\r\n\t\tif (user && this.validate(req, user)) {\r\n\t\t\tuser.skills.push(req);\r\n\t\t\tthis.wsWrapper.send(ws, SocketType.getSkill, user);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate validate(req: number, user: DbUserData) {\r\n\t\treturn (\r\n\t\t\ttypeof req === \"number\" &&\r\n\t\t\t!user.skills.includes(req)) &&\r\n\t\t\tuser.lv >= (user.skills.length + 1) * 10;\r\n\t}\r\n}"],"sourceRoot":"/source/"}