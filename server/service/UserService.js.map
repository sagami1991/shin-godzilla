{"version":3,"sources":["service/UserService.ts"],"names":[],"mappings":";AAGA;IAGC,qBAAoB,KAAmB;QAAnB,UAAK,GAAL,KAAK,CAAc;IACvC,CAAC;IAEM,6BAAO,GAAd,UAAe,EAAU;QACxB,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,EAAC,GAAG,EAAE,EAAE,EAAC,CAAC,CAAC;IACxE,CAAC;IAED,gBAAgB;IAChB,cAAc;IACP,+BAAS,GAAhB;QACC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,WAAW,CAAC,MAAM,CAAC;aAClD,IAAI,CAAC,EAAE,EAAE,EAAC,GAAG,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAC,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC;IAC1E,CAAC;IAEM,gCAAU,GAAjB,UAAkB,IAAgB;QACjC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,UAAA,CAAC;YACvE,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAClB,CAAC,CAAC,CAAC;IACJ,CAAC;IAEM,gCAAU,GAAjB,UAAkB,IAAgB;QACjC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,SAAS,CAAC,EAAC,GAAG,EAAE,IAAI,CAAC,GAAG,EAAC,EAAE,IAAI,CAAC,CAAC,KAAK,CAAC,UAAA,CAAC;YAC3F,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAClB,CAAC,CAAC,CAAC;IACJ,CAAC;IAEM,gCAAU,GAAjB,UAAkB,MAAc,EAAE,GAAW;QAC5C,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,SAAS,CAAC,EAAC,GAAG,EAAE,MAAM,EAAC,EAAE,EAAC,GAAG,EAAE,GAAG,EAAC,CAAC,CAAC,KAAK,CAAC,UAAA,CAAC;YACvF,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QACnB,CAAC,CAAC,CAAC;IACJ,CAAC;IAEM,gCAAU,GAAjB,UAAkB,EAAU;QAC3B,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,SAAS,CAAC,EAAC,GAAG,EAAE,EAAE,EAAC,CAAC,CAAC;IACnE,CAAC;IAEM,mCAAa,GAApB,UAAqB,MAAc;QAClC,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,WAAW,CAAC,eAAe,CAAC,CAAC,SAAS,CAAC,EAAC,EAAE,EAAE,MAAM,EAAC,CAAC,CAAC;IAC/E,CAAC;IAEM,oCAAc,GAArB,UAAsB,MAAc;QAApC,iBAMC;QALA,MAAM,CAAC,IAAI,OAAO,CAAO,UAAC,OAAO,EAAE,MAAM;YACxC,KAAI,CAAC,KAAK,CAAC,aAAa,CAAC,WAAW,CAAC,eAAe,CAAC,CAAC,OAAO,CAAC,EAAC,EAAE,EAAE,MAAM,EAAC,CAAC,CAAC,IAAI,CAAC,UAAA,KAAK;gBACrF,CAAC,KAAK,GAAG,OAAO,EAAE,GAAG,MAAM,EAAE,CAAC;YAC/B,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;IACJ,CAAC;IAhDc,kBAAM,GAAG,OAAO,CAAC;IACjB,2BAAe,GAAG,OAAO,CAAC;IAiD1C,kBAAC;AAAD,CAnDA,AAmDC,IAAA;AAnDY,mBAAW,cAmDvB,CAAA","file":"service/UserService.js","sourcesContent":["import {DbUserData, RankingInfo} from \"../share/share\";\r\nimport {MongoWrapper} from \"../server\";\r\n\r\nexport class UserService {\r\n\tprivate static C_NAME = \"users\";\r\n\tprivate static BANS_COLLECTION = \"banip\";\r\n\tconstructor(private mongo: MongoWrapper) {\r\n\t}\r\n\r\n\tpublic getUser(id: string): Promise<DbUserData> {\r\n\t\treturn this.mongo.getCollection(UserService.C_NAME).findOne({_id: id});\r\n\t}\r\n\r\n\t// TODO インデックス貼る\r\n\t/** 上位数人を返す */\r\n\tpublic getRanker(): Promise<RankingInfo[]> {\r\n\t\treturn this.mongo.getCollection(UserService.C_NAME)\r\n\t\t.find({}, {_id: 0, lv: 1, name: 1}).limit(10).sort({ lv: -1 }).toArray();\r\n\t}\r\n\r\n\tpublic createUser(user: DbUserData) {\r\n\t\treturn\tthis.mongo.getCollection(UserService.C_NAME).insert(user).catch(e => {\r\n\t\t\tconsole.trace(e);\r\n\t\t});\r\n\t}\r\n\r\n\tpublic updateUser(user: DbUserData) {\r\n\t\treturn this.mongo.getCollection(UserService.C_NAME).updateOne({_id: user._id}, user).catch(e => {\r\n\t\t\tconsole.trace(e);\r\n\t\t});\r\n\t}\r\n\r\n\tpublic increseExp(userId: string, exp: number) {\r\n\t\tthis.mongo.getCollection(UserService.C_NAME).updateOne({_id: userId}, {exp: exp}).catch(e => {\r\n\t\t\t\tconsole.trace(e);\r\n\t\t});\r\n\t}\r\n\r\n\tpublic deleteUser(id: string) {\r\n\t\tthis.mongo.getCollection(UserService.C_NAME).deleteOne({_id: id});\r\n\t}\r\n\r\n\tpublic insertBanList(ipAddr: string) {\r\n\t\tthis.mongo.getCollection(UserService.BANS_COLLECTION).insertOne({ip: ipAddr});\r\n\t}\r\n\r\n\tpublic containBanList(ipAddr: string): Promise<void> {\r\n\t\treturn new Promise<void>((resolve, reject) => {\r\n\t\t\tthis.mongo.getCollection(UserService.BANS_COLLECTION).findOne({ip: ipAddr}).then(value => {\r\n\t\t\t\t!value ? resolve() : reject();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n}"],"sourceRoot":"/source/"}