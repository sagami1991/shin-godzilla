{"version":3,"sources":["service/UserService.ts"],"names":[],"mappings":";AAGA;IACC,qBAAoB,UAAsB;QAAtB,eAAU,GAAV,UAAU,CAAY;IAC1C,CAAC;IAEM,6BAAO,GAAd,UAAe,EAAU;QACxB,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,EAAC,GAAG,EAAE,EAAE,EAAC,CAAC,CAAC;IAC3C,CAAC;IAED,eAAe;IACR,+BAAS,GAAhB;QACC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC;IACpE,CAAC;IAEM,gCAAU,GAAjB,UAAkB,IAAgB;QAAlC,iBAKC;QAJA,MAAM,CAAC,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YAClC,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,OAAO,EAAE,GAAG,MAAM,EAAE,CAAC;YAC3C,KAAI,CAAC,UAAU,CAAC,MAAM,CAAC,KAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;IACJ,CAAC;IAEM,gCAAU,GAAjB,UAAkB,IAAgB;QAAlC,iBAKC;QAJA,MAAM,CAAC,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YAClC,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,OAAO,EAAE,GAAG,MAAM,EAAE,CAAC;YAC3C,KAAI,CAAC,UAAU,CAAC,MAAM,CAAC,EAAC,GAAG,EAAE,IAAI,CAAC,GAAG,EAAC,EAAE,KAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC;QACpE,CAAC,CAAC,CAAC;IACJ,CAAC;IAEM,gCAAU,GAAjB,UAAkB,EAAU;QAC3B,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,EAAC,GAAG,EAAE,EAAE,EAAC,CAAC,CAAC;IACtC,CAAC;IAEO,oCAAc,GAAtB,UAAuB,IAAgB;QACtC,MAAM,CAAC;YACN,GAAG,EAAE,IAAI,CAAC,GAAG;YACb,EAAE,EAAE,IAAI,CAAC,EAAE;YACX,IAAI,EAAE,IAAI,CAAC,IAAI;YACf,GAAG,EAAE,IAAI,CAAC,GAAG;YACb,IAAI,EAAE,IAAI,IAAI,EAAE;SAChB,CAAC;IACH,CAAC;IAEO,8BAAQ,GAAhB,UAAiB,IAAgB;QAChC,MAAM,CAAC,CACN,IAAI,CAAC,GAAG;YACR,IAAI,CAAC,IAAI;YACT,OAAO,IAAI,CAAC,EAAE,KAAK,QAAQ;YAC3B,OAAO,IAAI,CAAC,GAAG,KAAK,QAAQ,CAC3B,CAAC;IACJ,CAAC;IACF,kBAAC;AAAD,CAjDA,AAiDC,IAAA;AAjDY,mBAAW,cAiDvB,CAAA","file":"service/UserService.js","sourcesContent":["import {Collection} from \"mongodb\";\r\nimport {DbUserData} from \"../share/share\";\r\n\r\nexport class UserService {\r\n\tconstructor(private collection: Collection) {\r\n\t}\r\n\r\n\tpublic getUser(id: string): Promise<DbUserData> {\r\n\t\treturn this.collection.findOne({_id: id});\r\n\t}\r\n\r\n\t/** 上位20人を返す */\r\n\tpublic getRanker(): Promise<DbUserData[]> {\r\n\t\treturn this.collection.find().limit(20).sort({ lv: -1 }).toArray();\r\n\t}\r\n\r\n\tpublic createUser(user: DbUserData) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.validate(user) ? resolve() : reject();\r\n\t\t\tthis.collection.insert(this.filterUserData(user));\r\n\t\t});\r\n\t}\r\n\r\n\tpublic updateUser(user: DbUserData) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.validate(user) ? resolve() : reject();\r\n\t\t\tthis.collection.update({_id: user._id}, this.filterUserData(user));\r\n\t\t});\r\n\t}\r\n\r\n\tpublic deleteUser(id: string) {\r\n\t\tthis.collection.deleteOne({_id: id});\r\n\t}\r\n\r\n\tprivate filterUserData(user: DbUserData): DbUserData {\r\n\t\treturn {\r\n\t\t\t_id: user._id,\r\n\t\t\tlv: user.lv,\r\n\t\t\tname: user.name,\r\n\t\t\texp: user.exp,\r\n\t\t\tdate: new Date()\r\n\t\t};\r\n\t}\r\n\r\n\tprivate validate(user: DbUserData) {\r\n\t\treturn (\r\n\t\t\tuser._id &&\r\n\t\t\tuser.name &&\r\n\t\t\ttypeof user.lv === \"number\" &&\r\n\t\t\ttypeof user.exp === \"number\"\r\n\t\t\t);\r\n\t}\r\n}"],"sourceRoot":"/source/"}