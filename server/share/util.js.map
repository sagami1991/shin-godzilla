{"version":3,"sources":["share/util.ts"],"names":[],"mappings":"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","file":"share/util.js","sourcesContent":["export class DiffExtract {\r\n\tprivate static FORCE_KEY = \"pid\";\r\n\tpublic static diff(prevObj: Object, nextObj: Object): Object {\r\n\t\tif (!prevObj || !nextObj) return undefined;\r\n\t\treturn this.objDiff(prevObj, nextObj);\r\n\t}\r\n\r\n\tprivate static objDiff(prevObj: {[key: string]: any}, nextObj: {[key: string]: any}): {[key: string]: any} {\r\n\t\tif (prevObj === undefined) {\r\n\t\t\treturn nextObj;\r\n\t\t}\r\n\r\n\t\tconst result: {[key: string]: any} = {};\r\n\t\tObject.keys(nextObj).forEach((key) => {\r\n\t\t\tconst next = nextObj[key];\r\n\t\t\tconst prev = prevObj[key];\r\n\t\t\tif (Array.isArray(next)) {\r\n\t\t\t\tconst arr = this.arrDiff(prev, next);\r\n\t\t\t\tif (arr) result[key] = arr;\r\n\t\t\t} else if (typeof next === \"object\") {\r\n\t\t\t\tconst obj = this.objDiff(prev, next);\r\n\t\t\t\tif (obj) result[key] = obj;\r\n\t\t\t} else if (typeof next !== \"undefined\" && next !== prev) {\r\n\t\t\t\tresult[key] = next;\r\n\t\t\t\t// personIDは絶対入れる\r\n\t\t\t\tif (nextObj[\"pid\"] && !result[\"pid\"]) {\r\n\t\t\t\t\tresult[\"pid\"] = nextObj[\"pid\"];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn !this.isEmpty(result) ? result : undefined;\r\n\t}\r\n\r\n\tprivate static arrDiff(befArr: any[], nextArr: any[]): any[] {\r\n\t\tif (befArr === undefined) {\r\n\t\t\treturn nextArr;\r\n\t\t}\r\n\t\tconst result: any[] = [];\r\n\t\tnextArr.forEach((next, i) => {\r\n\t\t\tconst prev = befArr[i];\r\n\t\t\tif (Array.isArray(next) && Array.isArray(prev)) {\r\n\t\t\t\tconst arr = this.arrDiff(prev, next);\r\n\t\t\t\tif (arr) result.push(arr);\r\n\t\t\t} else if (typeof next === \"object\") {\r\n\t\t\t\tconst obj = this.objDiff(prev, next);\r\n\t\t\t\tif (obj) result.push(obj);\r\n\t\t\t} else if (typeof next !== \"undefined\") {\r\n\t\t\t\tresult.push(next);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn !this.isEmpty(result) ? result : undefined;\r\n\t}\r\n\r\n\tprivate static isEmpty(obj: {[key: string]: any} | any[]): boolean {\r\n\t\tif (Array.isArray(obj)) {\r\n\t\t\treturn !obj.length ? true : false;\r\n\t\t} else {\r\n\t\t\treturn !Object.keys(obj).length ? true : false;\r\n\t\t}\r\n\t}\r\n}"],"sourceRoot":"/source/"}